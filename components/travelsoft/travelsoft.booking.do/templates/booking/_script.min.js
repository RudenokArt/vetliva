"use strict";!function(e,s){function t(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}function o(s){var t=b.$mount_point.siblings("#"+b.error_box_html_id),o=null;t.length||((o=b.$mount_point.next()).length?o.after("<div id='"+b.error_box_html_id+"' style='color: red; display:none'></div>"):b.$email_input.before("<div id='"+b.error_box_html_id+"' style='color: red; display:none'></div>"),t=e("#"+b.error_box_html_id)),t.text(s),t.slideDown()}function a(){e("#"+b.error_box_html_id).remove()}function r(s){var t=b.$mount_point.next("#"+b.message_box_id);t.length||(b.$mount_point.after("<div id='"+b.message_box_id+"' style='color: green; display:none'></div>"),t=e("#"+b.message_box_id)),t.text(s),t.slideDown()}function i(){e("#"+b.message_box_id).remove()}function n(){b.$mount_point.next("#"+b.registration_box_id).length||(b.$mount_point.after("<div id='"+b.registration_box_id+'\'><div class="form-field"><input onpaste=\'return false;\' name="confirm_email" required="" type="email" placeholder="'+b.messages.placeholder_confirm_email+'" class="field-input"></div></div>'),e("#"+b.booking_btn_id).on("click",function(s){var a=b.$email_input.val(),r=e("#"+b.registration_box_id).find("input[name='confirm_email']").val(),i=e(this);s.preventDefault(),t(r)?r.toString()===a.toString()?g({beforeSend:function(){e("#form-shading").show()},complete:function(){e("#form-shading").hide(),i.html(b.messages.booking_btn)},action:"do_registration",email:a,confirm_email:r}):o(b.messages.confirm_email_not_equal_email):o(b.messages.confirm_email_error)}))}function _(){e("#"+b.booking_btn_id).off("click"),e("#"+b.registration_box_id).remove()}function m(){e("#"+b.authorize_box_id).length||(b.$mount_point.after("<div id='"+b.authorize_box_id+'\'><div class="form-field"><input name="password" required="" type="password" placeholder="'+b.messages.placeholder_password+"\" class=\"field-input\"></div><div style='text-align: right'><div style='padding: 5px 0'><a href='"+b.forgot_password_link+"'>"+b.messages.forgot_password+"</a></div></div></div>"),e("#"+b.booking_btn_id).on("click",function(s){var t=e("#"+b.authorize_box_id+" input[name='password']").val();e(this);""!==t.toString()?(g({beforeSend:function(){e("#form-shading").show()},complete:function(){e("#form-shading").hide()},email:b.$email_input.val(),password:t,action:"do_authorize"}),s.preventDefault()):o(b.messages.enter_the_password)}))}function l(){e("#"+b.booking_btn_id).off("click"),e("#"+b.authorize_box_id).remove()}function u(e){e?(b.$email_input.off("focusout"),a(),_(),l()):(a(),i(),_(),l())}function g(t){var a={sessid:b.sessid,action:t.action};t.email&&(a.email=t.email),t.confirm_email&&(a.confirm_email=t.confirm_email),t.password&&(a.password=t.password),"number"==typeof t.position&&(a.position=t.position),"string"==typeof t.promo&&(a.promo=t.promo),e.ajax({url:f,data:a,method:"POST",dataType:"Json",complete:function(){b.ajax_flag=!1,"function"==typeof t.complete&&t.complete()},beforeSend:function(e){if(b.ajax_flag)return e.abort(),!1;b.ajax_flag=!1,"function"==typeof t.beforeSend&&t.beforeSend()},statusCode:{404:function(){alert(b.messages._404)}},success:function(a){if(void 0!==(a=s.parse(a)).status){if(0===a.status)return t.that.html("&times"),alert(b.messages.status_0),!0;if(1===a.status){if(t.that.off("click"),b.active_service_count--,b.cart_items_count--,b.active_service_count<=0&&e("#"+b.booking_form_id).remove(),b.cart_items_count<=0)t.that.closest("."+b.cart_item_class_container).replaceWith(b.empty_cart_message);else{t.that.closest("."+b.cart_item_class_container).remove(),e(b.discountAreaSelector).text(a.discount),e(b.costAreaSelector).text(a.cost),e(b.totalAreaSelector).text(a.total),e(b.promoAreaSelector).text(b.messages.no_promo);for(i=0;i<a.promocodes.length;i++)e(b.promoAreaSelector).text(a.promocodes.join(", "));a.count_of_people<=b.totalCountOfPeople&&e("#add-tourist-btn").remove()}return!0}if(4===a.status||5===a.status||7===a.status)return o(b.messages["status_"+a.status]||a.message),!0;if(6===a.status||3===a.status)return r(b.messages["status_"+a.status]||a.message),b.is_authorized=!0,u(!0),e("#"+b.booking_btn_id).trigger("click"),3===a.status&&a.is_agent&&e("#accept").parent().remove(),!0;if(8===a.status)return n(),r(b.messages.status_8),!0;if(9===a.status)return m(),r(b.messages.status_9),!0;if(-1!==[10,11,12,13,14,15,16,17,18].indexOf(a.status)){if(17===a.status){e(b.discountAreaSelector).text(a.discount),e(b.costAreaSelector).text(a.cost),e(b.totalAreaSelector).text(a.total),e(b.promoAreaSelector).text(b.messages.no_promo);for(var i=0;i<a.promocodes.length;i++)e(b.promoAreaSelector).text(a.promocodes.join(", "))}return alert(b.messages["status_"+a.status]),!0}}alert(b.messages.default_error_text)},error:function(){alert(b.messages._500)}})}function c(){b.$email_input.on("focusout",function(){var e=b.$email_input.val();return u(),""===e?(o(b.messages.empty_email),!1):t(e)?void g({email:e,action:"check_auth"}):(o(b.messages.status_2),!1)})}function d(s,t){e("#"+s).on("click",function(){var s=e(this);g({action:"delete_pos",position:t,that:s,beforeSend:function(){s.html("<img src='"+b.preloader+"' alt='gif-preloader'>")}})})}function p(){var e;b.del_pos;for(e in b.del_pos)d(b.del_pos[e].html_id,b.del_pos[e].position)}var f="/local/components/travelsoft/travelsoft.booking.do/ajax.php",b={sessid:null,cart_item_class_container:"item-cart",booking_form_id:"booking",preloader:null,active_service_count:0,cart_items_count:0,empty_cart_message:"your cart is empty",del_pos_array:null,messages:{booking_btn:"BOOKING NOW",confirm_email_error:"error",confirm_email_not_equal_email:"error",placeholder_confirm_email:"Confirm email",placeholder_password:"Password",do_registration_button:"Register",do_authorize_button:"Authorize",forgot_password:"forgot password",empty_email:"empty email",enter_the_password:"Enter the password",_404:"System error. Please contact the site administrator (_404)",_500:"System error. please contact the site administrator (_500)",default_error_text:"Error. Please contact the site administrator (_default)",status_0:"error",status_1:"error",status_2:"error",status_3:"error",status_4:"error",status_5:"error",status_6:"error",status_7:"error",status_8:"error",status_9:"error"},email_input_id:null,forgot_password_link:null,message_box_id:"__message-box",is_authorized:!1,error_box_html_id:"__error-box",registration_box_id:"__registration_box",authorize_box_id:"__authorize_box",ajax_flag:!1,$email_input:null,$mount_point:null,$booking_btn:null};e.make_booking_component_dialog=function(s){if("string"==typeof s.sessid&&""!==s.sessid&&(b.sessid=s.sessid),"string"!=typeof s.forgot_password_link&&""===s.forgot_password_link||(b.forgot_password_link=s.forgot_password_link),"boolean"==typeof s.is_authorized&&(b.is_authorized=s.is_authorized),"object"==typeof s.messages&&("string"==typeof s.messages.booking_btn&&(b.messages.booking_btn=s.messages.booking_btn),"string"==typeof s.messages.confirm_email_error&&(b.messages.confirm_email_error=s.messages.confirm_email_error),"string"==typeof s.messages.confirm_email_not_equal_email&&(b.messages.confirm_email_not_equal_email=s.messages.confirm_email_not_equal_email),"string"==typeof s.messages.placeholder_confirm_email&&(b.messages.placeholder_confirm_email=s.messages.placeholder_confirm_email),"string"==typeof s.messages.placeholder_password&&(b.messages.placeholder_password=s.messages.placeholder_password),"string"==typeof s.messages.do_registration_button&&(b.messages.do_registration_button=s.messages.do_registration_button),"string"==typeof s.messages.do_authorize_button&&(b.messages.do_authorize_button=s.messages.do_authorize_button),"string"==typeof s.messages.enter_the_password&&(b.messages.enter_the_password=s.messages.enter_the_password),"string"==typeof s.messages._404&&(b.messages._404=s.messages._404),"string"==typeof s.messages._500&&(b.messages._500=s.messages._500),"string"==typeof s.messages.default_error_text&&(b.messages.default_error_text=s.messages.default_error_text),"string"==typeof s.messages.status_0&&(b.messages.status_0=s.messages.status_0),"string"==typeof s.messages.status_1&&(b.messages.status_1=s.messages.status_1),"string"==typeof s.messages.status_2&&(b.messages.status_2=s.messages.status_2),"string"==typeof s.messages.status_3&&(b.messages.status_3=s.messages.status_3),"string"==typeof s.messages.status_4&&(b.messages.status_4=s.messages.status_4),"string"==typeof s.messages.status_5&&(b.messages.status_5=s.messages.status_5),"string"==typeof s.messages.status_6&&(b.messages.status_6=s.messages.status_6),"string"==typeof s.messages.status_7&&(b.messages.status_7=s.messages.status_7),"string"==typeof s.messages.status_8&&(b.messages.status_8=s.messages.status_8),"string"==typeof s.messages.status_9&&(b.messages.status_9=s.messages.status_9),"string"==typeof s.messages.empty_email&&(b.messages.empty_email=s.messages.empty_email),"string"==typeof s.preloader&&""!==s.preloader&&(b.preloader=s.preloader)),"string"==typeof s.booking_btn_id&&(b.booking_btn_id=s.booking_btn_id),"string"==typeof s.mount_point_id&&(b.$mount_point=e("#"+s.mount_point_id)),b.is_authorized||"string"!=typeof s.email_input_id||(b.$email_input=e("#"+s.email_input_id),b.$email_input.length&&c()),"string"==typeof s.empty_cart_message&&(b.empty_cart_message=s.empty_cart_message),"number"==typeof s.cart_items_count&&(b.cart_items_count=s.cart_items_count),"number"==typeof s.active_service_count&&(b.active_service_count=s.active_service_count),"string"==typeof s.cart_item_class_container&&(b.cart_item_class_container=s.cart_item_class_container),"string"==typeof s.booking_form_id&&(b.booking_form_id=s.booking_form_id,e("#"+b.booking_form_id).on("submit",function(){if("function"==typeof s.sendBeforeForm)return s.sendBeforeForm(b)})),"object"==typeof s.del_pos&&(b.del_pos=s.del_pos,p()),"object"==typeof s.additional_tourists){var t=s.additional_tourists,o=t.count,a=t.index;b.totalCountOfPeople=t.count,e(document).on("click","#add-tourist-btn",function(s){var r=null,i=null,n=t.template;if(o>0){for(r=(i=e(".tourist-row:last")).find(".additional-tourist-area"),n=n.replace("#number#",a+1);-1!==n.indexOf("#index#");)n=n.replace("#index#",a);r.length?r.replaceWith(n):i.length&&i.after('<div class="row form bg-none tourist-row">'+n+'<span class="additional-tourist-area"></span></div>'),a++,0===--o&&e("#add-tourist-btn").remove(),e(".birthdate-field").mask("99.99.9999")}s.preventDefault()})}"string"==typeof s.promoSelectorBtn&&("string"==typeof s.messages.status_10&&(b.messages.status_10=s.messages.status_10),"string"==typeof s.messages.status_11&&(b.messages.status_11=s.messages.status_11),"string"==typeof s.messages.status_12&&(b.messages.status_12=s.messages.status_12),"string"==typeof s.messages.status_13&&(b.messages.status_13=s.messages.status_13),"string"==typeof s.messages.status_14&&(b.messages.status_14=s.messages.status_14),"string"==typeof s.messages.status_15&&(b.messages.status_15=s.messages.status_15),"string"==typeof s.messages.status_16&&(b.messages.status_16=s.messages.status_16),"string"==typeof s.messages.status_17&&(b.messages.status_17=s.messages.status_17),"string"==typeof s.messages.status_18&&(b.messages.status_18=s.messages.status_18),"string"==typeof s.messages.no_promo&&(b.messages.no_promo=s.messages.no_promo),"string"==typeof s.totalAreaSelector&&(b.totalAreaSelector=s.totalAreaSelector),"string"==typeof s.costAreaSelector&&(b.costAreaSelector=s.costAreaSelector),"string"==typeof s.discountAreaSelector&&(b.discountAreaSelector=s.discountAreaSelector),"string"==typeof s.promoAreaSelector&&(b.promoAreaSelector=s.promoAreaSelector),e(document).on("click",s.promoSelectorBtn,function(s){var t=e(e(this).data("input-link")),o=t.val().toString();""!==o?g({action:"apply_promo",promo:o,complete:function(){t.val("")}}):alert(b.messages.status_10),s.preventDefault()}))}}(jQuery,JSON);